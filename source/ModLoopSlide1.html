<template>
  <div id="modquee">
    <div id="modquee-contain">
      <div class="modquee-items">
        <img src="https://itp1.itopfile.com/Images/photos/no-image.jpg" alt="" />
      </div>
      <div class="modquee-items">
        <img src="https://itp1.itopfile.com/Images/photos/no-image.jpg" alt="" />
      </div>
      <div class="modquee-items">
        <img src="https://itp1.itopfile.com/Images/photos/no-image.jpg" alt="" />
      </div>
      <div class="modquee-items">
        <img src="https://itp1.itopfile.com/Images/photos/no-image.jpg" alt="" />
      </div>
      <div class="modquee-items">
        <img src="https://itp1.itopfile.com/Images/photos/no-image.jpg" alt="" />
      </div>
      <div class="modquee-items">
        <img src="https://itp1.itopfile.com/Images/photos/no-image.jpg" alt="" />
      </div>
      <div class="modquee-items">
        <img src="https://itp1.itopfile.com/Images/photos/no-image.jpg" alt="" />
      </div>
      <div class="modquee-items">
        <img src="https://itp1.itopfile.com/Images/photos/no-image.jpg" alt="" />
      </div>
      <div class="modquee-items">
        <img src="https://itp1.itopfile.com/Images/photos/no-image.jpg" alt="" />
      </div>
    </div>
  </div>
</template>

<style>
  #modquee {
    overflow: hidden;
    position: relative;
    display: flex;
    height: 300px;
    width: 100%;
    margin: 0 auto;
  }

  #modquee-contain {
    display: flex;
    position: absolute;
    inset: 0;
  }

  .modquee-items {
    padding: 20px;
    aspect-ratio: 1;
    height: fit-content;
    width: fit-content;
    min-width: auto;
  }

  .modquee-items img {
    height: 250px !important;
    width: 250px !important;
    border-radius: 25px;
    box-shadow: 0 4px 18px rgb(0, 0, 0, 0.1);
  }
</style>

<script>
  const observer = new MutationObserver(() => {
    const container = document.querySelector("#modquee");
    const box = document.querySelector("#modquee-contain");
    if (!container || !box) return;

    // Speed setting (pixels per second)
    const speed = 100;

    // Wait for all images to load
    const imgs = box.querySelectorAll("img");
    let loaded = 0;
    imgs.forEach((img) => {
      if (img.complete) loaded++;
      else
        img.onload = img.onerror = () => {
          loaded++;
          if (loaded === imgs.length) setup();
        };
    });
    if (loaded === imgs.length) setup();

    function setup() {
      const containerWidth = container.clientWidth;
      let boxWidth = box.scrollWidth;

      let cloneCount = 0;
      while (boxWidth < containerWidth * 2 && cloneCount < 10) {
        const clone = box.cloneNode(true);
        clone.querySelectorAll("img").forEach((img) => (img.loading = "lazy"));
        box.appendChild(...clone.childNodes);
        boxWidth = box.scrollWidth;
        cloneCount++;
      }
      const duration = boxWidth / speed + "s"; // Speed control

      document.querySelectorAll("style[data-marquee]").forEach((el) => el.remove());

      const style = document.createElement("style");
      style.setAttribute("data-marquee", "true");
      style.innerHTML = `
      @keyframes slideLeft {
        0% { transform: translateX(0); }
        100% { transform: translateX(-${boxWidth}px); }
      }
      @keyframes slideLeftClone {
        0% { transform: translateX(${boxWidth}px); }
        100% { transform: translateX(0); }
      }
    `;
      document.head.appendChild(style);

      // Style container and box
      Object.assign(container.style, {
        position: "relative",
      });

      Object.assign(box.style, {
        position: "absolute",
        left: "0",
        top: "0",
        whiteSpace: "nowrap",
        zIndex: "1",
        animation: `slideLeft ${duration} linear infinite`,
      });

      // Clone and animate second set
      const animClone = box.cloneNode(true);
      Object.assign(animClone.style, {
        position: "absolute",
        left: "0",
        top: "0",
        whiteSpace: "nowrap",
        zIndex: "2",
        transform: `translateX(-${boxWidth}px)`,
        animation: `slideLeftClone ${duration} linear infinite`,
      });
      container.appendChild(animClone);

      observer.disconnect();
    }
  });

  observer.observe(document.body, { childList: true, subtree: true });
</script>
