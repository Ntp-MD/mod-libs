<div class="set_num" data-start="0" data-stop="100"></div>
<script>
  $(document).ready(() => {
    const config = { duration: 1500, once: false, showDecimal: true };
    const easeOutQuad = (t) => t * (2 - t);

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          const el = entry.target;
          const data = el.dataset; // สั้นและเข้าใจง่าย

          if (entry.isIntersecting) {
            if (data.animating === "true") return;

            let startTime = null;
            const startVal = +data.start || 0;
            const endVal = +(data.stop || data.value);

            const step = (timestamp) => {
              startTime = startTime || timestamp;
              const progress = Math.min((timestamp - startTime) / config.duration, 1);
              const currentValue = easeOutQuad(progress) * (endVal - startVal) + startVal;

              const useDec = data.decimals !== "false" && config.showDecimal;
              const places = +data.places || 2;

              // แสดงผล
              const displayValue = useDec ? currentValue.toFixed(places) : Math.floor(currentValue);
              el.innerHTML = Number(displayValue).toLocaleString(undefined, {
                minimumFractionDigits: useDec ? places : 0,
                maximumFractionDigits: useDec ? places : 0,
              });

              if (progress < 1) {
                requestAnimationFrame(step);
              } else {
                data.animating = "false";
                if (data.once === "true" || config.once) observer.unobserve(el);
              }
            };

            data.animating = "true";
            requestAnimationFrame(step);
          } else if (data.once !== "true" && !config.once) {
            data.animating = "false";
          }
        });
      },
      { threshold: 0.2 },
    );

    $(".set_num").each((_, el) => observer.observe(el));
  });
</script>
