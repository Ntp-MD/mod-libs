<div class="set_num" data-start="0" data-stop="100"></div>

<script>
  //  mod v.5 lasted 28/1/2026
  $(document).ready(function () {
    const config = {
      once: false, // Set to true for one-time animation only
      duration: 1500,
    };

    function ModNumberRun(obj, start, end, duration, options = {}) {
      const { decimals = false, decimalPlaces = 2 } = options;
      let startTimestamp = null;

      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        let value = progress * (end - start) + start;

        obj.innerHTML = Math.floor(value).toLocaleString();

        if (progress < 1) {
          window.requestAnimationFrame(step);
        } else {
          if (decimals) {
            value = value.toFixed(decimalPlaces);
          } else {
            value = Math.floor(value);
          }
          obj.innerHTML = parseFloat(value).toLocaleString();
          onComplete();
        }
      };

      window.requestAnimationFrame(step);
    }

    const elements = document.querySelectorAll(".set_num");
    let animatedElements = new Map();
    let lastScrollTop = window.pageYOffset;

    function getScrollDirection() {
      const st = window.pageYOffset || document.documentElement.scrollTop;
      const direction = st > lastScrollTop ? "up" : "down";
      lastScrollTop = st <= 0 ? 0 : st;
      return direction;
    }

    function handleScroll() {
      const direction = getScrollDirection();

      elements.forEach((element) => {
        const rect = element.getBoundingClientRect();
        const elementTop = rect.top;
        const elementBottom = rect.bottom;
        const windowHeight = window.innerHeight;

        const animationState = animatedElements.get(element) || { animated: false };
        const triggerDown = direction === "down" && elementTop >= 0 && elementTop <= windowHeight * 0.5;
        const triggerUp = direction === "up" && elementBottom <= windowHeight && elementBottom >= windowHeight * 0.5;

        // Check if element has data-once attribute, otherwise use global config
        const elementOnce = element.hasAttribute("data-once") ? element.getAttribute("data-once") === "true" : config.once;

        if ((triggerDown || triggerUp) && !animationState.animated) {
          const startValue = parseFloat(element.getAttribute("data-start") || 0);
          const endValue = parseFloat(element.getAttribute("data-stop") || element.getAttribute("data-value"));
          const options = {
            decimals: element.getAttribute("data-decimals") !== "false",
            decimalPlaces: parseInt(element.getAttribute("data-places")) || 2,
          };

          ModNumberRun(element, startValue, endValue, config.duration, options);
          animationState.animated = true;
        } else if (!triggerDown && !triggerUp && !elementOnce) {
          animationState.animated = false; // Allow re-animation if once is false
        }

        animatedElements.set(element, animationState);
      });
    }

    $(window).scroll(handleScroll);

    $(window).on("load", function () {
      animatedElements.clear();
      lastScrollTop = window.pageYOffset;
      handleScroll(); // Initial check
    });
  });
</script>
